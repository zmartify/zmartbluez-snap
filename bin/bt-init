#!/bin/sh

if [ "$(id -u)" -ne 0 ]; then
   echo "This script must be run as root" 1>&2
   exit 1
fi

set -e

# Set hostname to ZmartHUB.'serialno'
#
#

BTNAME="ZmartHUB-$(cat /proc/cpuinfo | grep Serial | cut -d ' ' -f 2)"

MYHW="$(cat /proc/cpuinfo |grep ^Hardware|sed 's/^.*: //')"
HCIATTACH="$SNAP/usr/bin/hciattach"
HCICONFIG="$SNAP/usr/bin/hciconfig"
DEVICE=""

[ -x "$HCIATTACH" ] || exit 0

case "$MYHW" in
    BCM2709)
        DEVICE="Pi3"
        OPTS="/dev/ttyAMA0 bcm43xx 921600 noflow -"
        CFGUP="hci0 up"
    ;;
    *)
        exit 0
    ;;
esac

echo "Initializing $DEVICE Bluetooth: "

echo "Configuring options"
$HCIATTACH $OPTS

echo "Make sure hci0 is up and running"
$HCICONFIG $CFGUP

echo "done ..."

